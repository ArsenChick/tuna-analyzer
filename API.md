# Документация Tuna API

## Авторизация пользователя

Методы:

- `/api/login`
- `/api/signup`
- `/api/logout`

### /api/login

Методы: POST

Тело запроса - JSON вида:

```json5
{
    "username": "имя пользователя",   // string
    "password": "пароль пользователя" // string
}
```

Ответ:

- При успехе

HTTP код - 200

```json5
{
    "access_token": "access_token" // string
}
```

**access_token** - токен доступа, при дальнейших запросах необходимо добавлять токен в заголовок запроса `Authorization: Bearer access_token`

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```

### /api/signup

Методы: POST

Тело запроса - JSON вида:

```json5
{
    "username": "имя пользователя",            // string
    "password": "пароль",                      // string
    "password_confirm": "подтверждение пароля" // string
}
```

Ответ:

- При успехе

HTTP код - 200

```json5
{
    "access_token": "access_token" // string
}
```

**access_token** - токен доступа, при дальнейших запросах необходимо добавлять токен в заголовок запроса `Authorization: Bearer access_token`

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```

### /api/logout

Методы: GET

Аргументы: нет

Ответ:

- При успехе

HTTP код - 200

```json5
{
    "msg": "Сообщение об успехе"
}
```

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```

## Работа с результатами и файлами

### /api/save_results

Методы: POST
Заголовки: Authorization

Тело запроса - JSON вида:

```json5
{
    "bpm": 0,       // Темп композиции
    "tone": "tone", // Тональность композиции (string)
    "dance": 0,     // Танцевальность композиции
    "energy": 0,    // Энергичность композиции 
    "happiness": 0, // Настроение композиции
    "version": 0,   // Версия модели, на которой проводился анализ
    "file": {                       // загружаемый файл
        "filename": "file.mp3",     // имя файла
        "content": "base64_content" // содержимое файла
    }
}
```

> **tone** - значение из [списка тональностей](./Tones.md)

> Содержимое файла передаётся base64 строке
> **file[filename]** - имя файла
> **file[content]** - содержимое файла в виде base64 строки

Ответ:

- При успехе

HTTP код - 200

```json5
{
    "msg": "Сообщение об успехе"
}
```

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```

### /api/get_saves

Методы: GET
Аргументы: нет
Заголовки: Authorization

Ответ

- При успехе

HTTP код - 200

```json5
{
    "msg": "Сообщение об успехе",
    "ids": [
        1, 2, 3
    ]
}
```

**ids** - список id загрузок принадлежащих текущему пользователю.

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```

### /api/get_file

Методы: GET
Аргументы: id
Заголовки: Authorization

Ответ

- При успехе

HTTP код - 200

```json5
{
    "msg": "Сообщение об успехе",
    "file": {                       // файл
        "filename": "file.mp3",     // имя файла
        "content": "base64_content" // содержимое файла
    }
}
```

> Содержимое файла передаётся base64 строке
> **file[filename]** - имя файла
> **file[content]** - содержимое файла в виде base64 строки

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```

### /api/get_result

Методы: GET
Аргументы: id
Заголовки: Authorization

Ответ

- При успехе

HTTP код - 200

```json5
{
    "msg": "Сообщение об успехе",
    "bpm": 0,       // Темп композиции
    "tone": "tone", // Тональность композиции (string)
    "dance": 0,     // Танцевальность композиции
    "energy": 0,    // Энергичность композиции 
    "happiness": 0, // Настроение композиции
    "version": 0,   // Версия модели, на которой проводился анализ,
    "date": "dtime" // Дата и время обработки
}
```

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```

### /api/delete_result

Методы: DELETE
Аргументы: id
Заголовки: Authorization

Ответ

- При успехе

HTTP код - 200

```json5
{
    "msg": "Сообщение об успехе"
}
```

- При ошибке

HTTP код - соответствует спецификации HTTP

```json5
{
    "msg": "Сообщение об ошибке"
}
```
